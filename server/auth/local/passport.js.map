{"version":3,"sources":["auth/local/passport.js"],"names":["setup","localAuthenticate","User","email","password","done","findOne","toLowerCase","exec","then","user","message","approved","authenticate","authError","authenticated","catch","err","use","usernameField","passwordField"],"mappings":";;;;;QAgCgBA,K,GAAAA,K;;AAhChB;;;;AACA;;;;AAEA,SAASC,iBAAT,CAA2BC,IAA3B,EAAiCC,KAAjC,EAAwCC,QAAxC,EAAkDC,IAAlD,EAAwD;AACtDH,OAAKI,OAAL,CAAa;AACXH,WAAOA,MAAMI,WAAN;AADI,GAAb,EAEGC,IAFH,GAGGC,IAHH,CAGQ,gBAAQ;AACZ,QAAG,CAACC,IAAJ,EAAU;AACR,aAAOL,KAAK,IAAL,EAAW,KAAX,EAAkB;AACvBM,iBAAS;AADc,OAAlB,CAAP;AAGD;AACD,QAAI,CAACD,KAAKE,QAAV,EAAoB;AAClB,aAAOP,KAAK,IAAL,EAAW,KAAX,EAAkB;AACvBM,iBAAS;AADc,OAAlB,CAAP;AAGD;AACDD,SAAKG,YAAL,CAAkBT,QAAlB,EAA4B,UAASU,SAAT,EAAoBC,aAApB,EAAmC;AAC7D,UAAGD,SAAH,EAAc;AACZ,eAAOT,KAAKS,SAAL,CAAP;AACD;AACD,UAAG,CAACC,aAAJ,EAAmB;AACjB,eAAOV,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAEM,SAAS,+BAAX,EAAlB,CAAP;AACD,OAFD,MAEO;AACL,eAAON,KAAK,IAAL,EAAWK,IAAX,CAAP;AACD;AACF,KATD;AAUD,GAxBH,EAyBGM,KAzBH,CAyBS;AAAA,WAAOX,KAAKY,GAAL,CAAP;AAAA,GAzBT;AA0BD;;AAEM,SAASjB,KAAT,CAAeE,IAAf,CAAmB,YAAnB,EAAiC;AACtC,qBAASgB,GAAT,CAAa,4BAAkB;AAC7BC,mBAAe,OADc;AAE7BC,mBAAe,UAFc,CAEH;AAFG,GAAlB,EAGV,UAASjB,KAAT,EAAgBC,QAAhB,EAA0BC,IAA1B,EAAgC;AACjC,WAAOJ,kBAAkBC,IAAlB,EAAwBC,KAAxB,EAA+BC,QAA/B,EAAyCC,IAAzC,CAAP;AACD,GALY,CAAb;AAMD","file":"passport.js","sourcesContent":["import passport from 'passport';\r\nimport {Strategy as LocalStrategy} from 'passport-local';\r\n\r\nfunction localAuthenticate(User, email, password, done) {\r\n  User.findOne({\r\n    email: email.toLowerCase()\r\n  }).exec()\r\n    .then(user => {\r\n      if(!user) {\r\n        return done(null, false, {\r\n          message: 'This email is not registered.'\r\n        });\r\n      }\r\n      if (!user.approved) {\r\n        return done(null, false, {\r\n          message: 'This email is not approved yet. Please contact Admin for access'\r\n        });\r\n      } \r\n      user.authenticate(password, function(authError, authenticated) {\r\n        if(authError) {\r\n          return done(authError);\r\n        }\r\n        if(!authenticated) {\r\n          return done(null, false, { message: 'This password is not correct.' });\r\n        } else {\r\n          return done(null, user);\r\n        }\r\n      });\r\n    })\r\n    .catch(err => done(err));\r\n}\r\n\r\nexport function setup(User/*, config*/) {\r\n  passport.use(new LocalStrategy({\r\n    usernameField: 'email',\r\n    passwordField: 'password' // this is the virtual field on the model\r\n  }, function(email, password, done) {\r\n    return localAuthenticate(User, email, password, done);\r\n  }));\r\n}\r\n"]}